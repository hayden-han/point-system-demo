spring:
  profiles:
    active: local

  datasource:
    driver-class-name: org.h2.Driver
    url: jdbc:h2:mem:pointdb;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE
    username: sa
    password:
    # HikariCP - 100~1000 TPS 트래픽 대응 설정
    # 계산 근거: 평균 쿼리 시간 50ms 가정, 1000 TPS × 0.05s = 50 동시 커넥션 필요
    # 여유분 포함하여 최대 60, 평상시 30 유지
    hikari:
      pool-name: PointSystemPool
      maximum-pool-size: 60
      minimum-idle: 30
      connection-timeout: 3000       # 3초 대기 후 실패 (Fail Fast)
      validation-timeout: 1000       # 1초 내 연결 검증
      idle-timeout: 300000           # 5분 유휴 시 해제
      max-lifetime: 1800000          # 30분 후 커넥션 갱신
      leak-detection-threshold: 30000  # 30초 이상 미반환 시 경고

  jpa:
    hibernate:
      ddl-auto: none
    show-sql: false
    open-in-view: false              # 지연 로딩 방지, 성능 향상
    properties:
      hibernate:
        format_sql: true
        dialect: org.hibernate.dialect.H2Dialect

  sql:
    init:
      mode: always
      schema-locations: classpath:schema.sql
      data-locations: classpath:data.sql

  h2:
    console:
      enabled: false

server:
  port: 8083

# Actuator - 내부 서비스용 엔드포인트만 노출 (보안)
management:
  endpoints:
    web:
      exposure:
        include: health,prometheus   # 최소한의 노출 (K8s probes + metrics)
      base-path: /actuator
    enabled-by-default: false        # 기본 비활성화
  endpoint:
    health:
      enabled: true
      show-details: never            # 상세 정보 숨김 (보안)
      probes:
        enabled: true                # K8s liveness/readiness probes
    prometheus:
      enabled: true
  health:
    livenessstate:
      enabled: true
    readinessstate:
      enabled: true
  prometheus:
    metrics:
      export:
        enabled: true
