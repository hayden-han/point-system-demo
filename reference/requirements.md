# 요구사항 정의서

## 개요

무료 포인트 시스템 API를 개발한다. 포인트의 적립, 적립취소, 사용, 사용취소 기능을 제공한다.

## 산출물 체크리스트

- [ ] 기능 API 구현
- [ ] ERD (resource 디렉토리에 PDF 또는 이미지)
- [ ] AWS 아키텍처 구성도 (resource 디렉토리에 PDF 또는 이미지, 옵션)
- [ ] README.md에 빌드 방법 및 과제 설명

## 기능 요구사항

### 1. 적립 (Earn)

| ID | 요구사항 | 비고 |
|----|----------|------|
| E-1 | 1회 적립 가능 포인트는 최소 1포인트 이상 | 하드코딩 X, 설정값으로 제어 |
| E-2 | 1회 적립 가능 포인트는 최대 100,000포인트 이하 | 하드코딩 X, 설정값으로 제어 |
| E-3 | 개인별 보유 가능한 최대 포인트 제한 존재 | 하드코딩 X, 설정값으로 제어 |
| E-4 | 적립된 포인트는 어떤 주문에서 사용되었는지 1원 단위로 추적 가능해야 함 | |
| E-5 | 관리자 수기 지급 가능, 다른 적립과 구분 식별 가능해야 함 | |
| E-6 | 모든 포인트는 만료일 존재 | 최소 1일, 최대 5년 미만, 기본 365일 |

### 2. 적립취소 (Cancel Earn)

| ID | 요구사항 | 비고 |
|----|----------|------|
| CE-1 | 특정 적립건의 전체 금액만 취소 가능 | 부분 취소 불가 |
| CE-2 | 적립 금액 중 일부라도 사용된 경우 취소 불가 | |

### 3. 사용 (Use)

| ID | 요구사항 | 비고 |
|----|----------|------|
| U-1 | 주문 시에만 포인트 사용 가능 | |
| U-2 | 사용 시 주문번호 기록, 어떤 주문에서 얼마 사용했는지 식별 가능 | |
| U-3 | 관리자 수기 지급 포인트 우선 사용 | |
| U-4 | 만료일이 짧게 남은 순서로 사용 | 수기지급 우선 > 만료일 짧은 순 |

### 4. 사용취소 (Cancel Use)

| ID | 요구사항 | 비고 |
|----|----------|------|
| CU-1 | 사용 금액 중 전체 또는 일부 취소 가능 | 부분 취소 가능 |
| CU-2 | 이미 만료된 포인트를 사용취소 시 해당 금액만큼 신규 적립 처리 | |

## 예시 시나리오

```
1. 1000원 적립 (잔액: 0 → 1000)
   - pointKey: A 할당

2. 500원 적립 (잔액: 1000 → 1500)
   - pointKey: B 할당

3. 주문번호 A1234에서 1200원 사용 (잔액: 1500 → 300)
   - pointKey: C 할당
   - A에서 1000원 사용 → A 잔액: 1000 → 0
   - B에서 200원 사용 → B 잔액: 500 → 300

4. A의 적립이 만료됨

5. C의 사용금액 1200원 중 1100원 부분 사용취소 (잔액: 300 → 1400)
   - pointKey: D 할당 (사용취소 트랜잭션)
   - A는 만료됨 → pointKey E로 1000원 신규적립
   - B는 만료 안됨 → B 잔액: 300 → 400 (100원 복구)
   - C는 1200원 중 100원만 사용 상태로 남음 (추가 100원 부분취소 가능)
```

## 설정값 목록

하드코딩하지 않아야 하는 설정값:

| 설정 | 기본값 | 설명 |
|------|--------|------|
| 1회 최소 적립 금액 | 1 | E-1 |
| 1회 최대 적립 금액 | 100,000 | E-2 |
| 개인별 최대 보유 가능 금액 | (정의 필요) | E-3 |
| 기본 만료일 | 365일 | E-6 |
| 최소 만료일 | 1일 | E-6 |
| 최대 만료일 | 5년 미만 | E-6 |
