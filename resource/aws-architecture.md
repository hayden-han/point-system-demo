# AWS 아키텍처 구성도

## 시스템 아키텍처

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                                        AWS Cloud                                         │
│  ┌───────────────────────────────────────────────────────────────────────────────────┐  │
│  │                                    VPC (10.0.0.0/16)                               │  │
│  │                                                                                    │  │
│  │   ┌─────────────┐                                                                  │  │
│  │   │   Route53   │                                                                  │  │
│  │   │  (DNS)      │                                                                  │  │
│  │   └──────┬──────┘                                                                  │  │
│  │          │                                                                         │  │
│  │          ▼                                                                         │  │
│  │   ┌─────────────┐         ┌────────────────────────────────────────────────────┐  │  │
│  │   │     ALB     │         │              EKS Cluster                            │  │  │
│  │   │ (Internet   │         │  ┌──────────────────────────────────────────────┐  │  │  │
│  │   │  Facing)    │────────▶│  │           Istio Ingress Gateway              │  │  │  │
│  │   └─────────────┘         │  │  • JWT Validation                            │  │  │  │
│  │                           │  │  • Rate Limiting                             │  │  │  │
│  │                           │  │  • CORS                                      │  │  │  │
│  │                           │  └─────────────────┬────────────────────────────┘  │  │  │
│  │                           │                    │                                │  │  │
│  │                           │                    ▼                                │  │  │
│  │                           │  ┌──────────────────────────────────────────────┐  │  │  │
│  │                           │  │              Service Mesh (Istio)            │  │  │  │
│  │                           │  │  • mTLS                                      │  │  │  │
│  │                           │  │  • Circuit Breaker                           │  │  │  │
│  │                           │  │  • Retry Policy                              │  │  │  │
│  │                           │  └─────────────────┬────────────────────────────┘  │  │  │
│  │                           │                    │                                │  │  │
│  │                           │                    ▼                                │  │  │
│  │                           │  ┌──────────────────────────────────────────────┐  │  │  │
│  │                           │  │         Point Service (Deployment)           │  │  │  │
│  │                           │  │                                              │  │  │  │
│  │                           │  │  ┌────────┐  ┌────────┐  ┌────────┐         │  │  │  │
│  │                           │  │  │ Pod 1  │  │ Pod 2  │  │ Pod 3  │   HPA   │  │  │  │
│  │                           │  │  │        │  │        │  │        │  (2~10) │  │  │  │
│  │                           │  │  └────────┘  └────────┘  └────────┘         │  │  │  │
│  │                           │  │                                              │  │  │  │
│  │                           │  └──────────────────┬───────────────────────────┘  │  │  │
│  │                           │                     │                               │  │  │
│  │                           └─────────────────────┼───────────────────────────────┘  │  │
│  │                                                 │                                  │  │
│  │                      ┌──────────────────────────┴──────────────────────────┐       │  │
│  │                      │                                                     │       │  │
│  │                      ▼                                                     ▼       │  │
│  │   ┌──────────────────────────────────┐      ┌──────────────────────────────────┐  │  │
│  │   │      ElastiCache (Redis)         │      │           Aurora MySQL            │  │  │
│  │   │         Cluster Mode             │      │         (Multi-AZ)                │  │  │
│  │   │                                  │      │                                   │  │  │
│  │   │  ┌─────────┐    ┌─────────┐     │      │  ┌─────────┐    ┌─────────┐      │  │  │
│  │   │  │ Primary │    │ Replica │     │      │  │ Writer  │    │ Reader  │      │  │  │
│  │   │  │         │───▶│         │     │      │  │   (AZ-a)│    │  (AZ-c) │      │  │  │
│  │   │  └─────────┘    └─────────┘     │      │  └─────────┘    └─────────┘      │  │  │
│  │   │                                  │      │                                   │  │  │
│  │   │  • 분산락 (Redisson)             │      │  • member_point                   │  │  │
│  │   │  • 멱등성 캐시                    │      │  • point_ledger                   │  │  │
│  │   │                                  │      │  • ledger_entry                   │  │  │
│  │   └──────────────────────────────────┘      └──────────────────────────────────┘  │  │
│  │                                                                                    │  │
│  └───────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                          │
│   ┌──────────────────────────────────────────────────────────────────────────────────┐  │
│   │                              Monitoring & Logging                                 │  │
│   │                                                                                   │  │
│   │   ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐      │  │
│   │   │ CloudWatch  │    │  Prometheus │    │   Grafana   │    │    Kiali    │      │  │
│   │   │   Logs      │    │   (Metrics) │    │ (Dashboard) │    │(Service Mesh)│     │  │
│   │   └─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘      │  │
│   │                                                                                   │  │
│   └──────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                          │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

## 컴포넌트 상세

### 1. 네트워크 계층

| 컴포넌트 | 설명 |
|----------|------|
| Route53 | DNS 관리, 헬스체크 기반 라우팅 |
| ALB | HTTPS 종단, SSL/TLS 인증서 관리 |
| VPC | Private Subnet에 모든 리소스 배치 |

### 2. 컴퓨팅 계층 (EKS)

| 컴포넌트 | 설정 | 설명 |
|----------|------|------|
| Istio Gateway | - | JWT 검증, Rate Limiting, CORS |
| Service Mesh | mTLS | 서비스 간 암호화 통신 |
| Point Service | 2~10 Pods (HPA) | CPU 70% 기준 오토스케일링 |

### 3. 데이터 계층

| 컴포넌트 | 구성 | 용도 |
|----------|------|------|
| Aurora MySQL | Writer + Reader | 포인트 데이터 영속화 |
| ElastiCache Redis | Primary + Replica | 분산락, 멱등성 캐시 |

### 4. 모니터링

| 컴포넌트 | 용도 |
|----------|------|
| CloudWatch | 로그 수집, 알람 |
| Prometheus | 메트릭 수집 |
| Grafana | 대시보드 시각화 |
| Kiali | Istio 서비스 메시 관찰 |

## 가용성 설계

```
                    ┌─────────────────────────────────────┐
                    │            Multi-AZ 구성             │
                    │                                     │
    ┌───────────────┼───────────────┬─────────────────────┤
    │               │               │                     │
    ▼               ▼               ▼                     │
┌───────┐      ┌───────┐      ┌───────┐                  │
│ AZ-a  │      │ AZ-b  │      │ AZ-c  │                  │
│       │      │       │      │       │                  │
│ Pod 1 │      │ Pod 2 │      │ Pod 3 │  ← EKS Nodes     │
│       │      │       │      │       │                  │
│Aurora │      │       │      │Aurora │  ← DB            │
│Writer │      │       │      │Reader │                  │
│       │      │       │      │       │                  │
│Redis  │      │       │      │Redis  │  ← Cache         │
│Primary│      │       │      │Replica│                  │
└───────┘      └───────┘      └───────┘                  │
                    │                                     │
                    └─────────────────────────────────────┘
```

## 트래픽 흐름

```
Client Request
      │
      ▼
┌─────────────┐
│   Route53   │  DNS Resolution
└──────┬──────┘
       │
       ▼
┌─────────────┐
│     ALB     │  HTTPS Termination
└──────┬──────┘
       │
       ▼
┌─────────────┐
│   Istio     │  JWT Validation → X-Member-Id 헤더 주입
│   Gateway   │  Rate Limiting (1000 req/s)
└──────┬──────┘
       │
       ▼
┌─────────────┐
│   Point     │  비즈니스 로직 처리
│   Service   │
└──────┬──────┘
       │
       ├──────────────────┐
       │                  │
       ▼                  ▼
┌─────────────┐    ┌─────────────┐
│    Redis    │    │   Aurora    │
│ (분산락)     │    │  (데이터)    │
└─────────────┘    └─────────────┘
```

## 예상 비용 (월간, 서울 리전 기준)

| 서비스 | 스펙 | 예상 비용 |
|--------|------|-----------|
| EKS | 클러스터 + 3 Nodes (m5.large) | ~$300 |
| Aurora MySQL | db.r5.large (Multi-AZ) | ~$400 |
| ElastiCache | cache.r5.large (Cluster) | ~$250 |
| ALB | 처리량 기반 | ~$50 |
| 기타 (네트워크, 스토리지) | - | ~$100 |
| **합계** | | **~$1,100/월** |

> 실제 비용은 트래픽 양과 사용 패턴에 따라 달라질 수 있습니다.
